<!DOCTYPE html>
<html>
	<head>
		<title>Register - ToonStore</title>
		<link rel="stylesheet" type="text/css" href="css/register.css"/>
		<script src="js/jquery-1.10.1.js"></script>
		<script>

			// validate the contents of the form before submitting it
			var usernameAvailable = true;
			function validateForm()
			{
				// validate user
				var userValid = /[A-Za-z0-9_-]+/.test($('#username').val()) && usernameAvailable;
				if( !userValid ){
					$('#userError').html('Username is invalid!');
					$('#username').addClass('error');
				}
				else {
					$('#userError').empty();
					$('#username').removeClass('error');

				}

				// validate email
				var emailValid = /^[\w\d_\.\+-]+@[\w\d-_\.]+?\.\w{2,4}/.test($('#email').val());
				if( !emailValid ){
					$('#emailError').html('Email is invalid!');
					$('#email').addClass('error');
				}
				else {
					$('#emailError').empty();
					$('#email').removeClass('error');
				}

				// validate password
				var passwordValid = /^[\S]{5,}$/.test($('#password').val());
				if( !passwordValid ){
					$('#passwordError').html('Password must be at least 5 characters and not contain spaces');
					$('#password').addClass('error');
				}
				else {
					$('#passwordError').empty();
					$('#password').removeClass('error');
				}

				// confirm password
				var confirmValid = $('#confirm').val() == $('#password').val();
				if( !confirmValid ){
					$('#confirmError').html('Passwords do not match!');
					$('#confirm').addClass('error');
				}
				else {
					$('#confirmError').empty();
					$('#confirm').removeClass('error');
				}
			
				return userValid && emailValid && passwordValid && confirmValid;	
			}

			var checkNameTimeout = null;
			function checkUsername(elem)
			{
				// check the username against the active user list
				var callback = function(){
					$.get('/register/verify?a='+encodeURIComponent(elem.value), function(data)
					{
						if( data.found ){
							usernameAvailable = false;
							$('#userError').addClass('error').html('Username is already taken');
						} else {
							usernameAvailable = true;
							$('#userError').removeClass('error').html('Username is available');
						}
					});
				};

				// wait a second before checking the username
				if( checkNameTimeout )
					clearTimeout(checkNameTimeout);
				checkNameTimeout = setTimeout(callback, 1000);
			}

		</script>
	</head>
	<body>
		<h1>Create a user with ToonStore</h1>
		<p>Before you can create characters, you will have to register.</p>
		<p>(* indicates required fields)</p>
		
		<form action="/register" method="post" onsubmit="return validateForm();">
			<table>
				<tr>
					<td><label for="username">*Username:</label></td>
					<td><input type="text" name="username" id="username" onkeypress="checkUsername(this);"/></td>
					<td><p class="errorMessage" id='userError'/></td>
				</tr>
				<tr>
					<td><label for="email">*Email:</label></td>
					<td><input type="text" name="email" id="email"/></td>
					<td><p class="errorMessage" id='emailError'/></td>
				</tr>
				<tr>
					<td><label for="password">*Password:</label></td>
					<td><input type="password" name="password" id="password"/></td>
					<td><p class="errorMessage" id='passwordError'/></td>
				</tr>
				<tr>
					<td><label for="confirm">*Password (confirm):</label></td>
					<td><input type="password" id="confirm"/></td>
					<td><p class="errorMessage" id='confirmError'/></td>
				</tr>
				<tr><td>&nbsp;</td><td>
					<input type="submit" value="Submit"/>
				</td></tr>
			</table>
	
		</form>

	</body>
</html>
